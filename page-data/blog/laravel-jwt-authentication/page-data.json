{"componentChunkName":"component---src-templates-post-jsx","path":"/blog/laravel-jwt-authentication","webpackCompilationHash":"398099bebbe650493f13","result":{"data":{"markdownRemark":{"html":"<p>For creating REST API we use jwt token for stateless authentication. In this post I will show you how to add jwt to laravel for api authentication.</p>\n<h4>Laravel project setup</h4>\n<p>We can install laravel simply by composer command</p>\n<div class=\"gatsby-highlight\" data-language=\"no-highlight\"><pre class=\"language-no-highlight\"><code class=\"language-no-highlight\"># composer create-project --prefer-dist laravel/laravel laravel-jwt</code></pre></div>\n<p>After laravel installetion we then move to jwt part. We will use the package <a href=\"https://github.com/tymondesigns/jwt-auth\">jwt-auth</a> in our project. We will use develop version to avoid issue.</p>\n<div class=\"gatsby-highlight\" data-language=\"no-highlight\"><pre class=\"language-no-highlight\"><code class=\"language-no-highlight\"># composer require tymon/jwt-auth:dev-develop --prefer-source</code></pre></div>\n<p>In config/app.php add this to providers array</p>\n<div class=\"gatsby-highlight\" data-language=\"php\"><pre class=\"language-php\"><code class=\"language-php\"><span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span>\nTymon\\<span class=\"token package\">JWTAuth<span class=\"token punctuation\">\\</span>Providers<span class=\"token punctuation\">\\</span>LaravelServiceProvider</span><span class=\"token punctuation\">:</span><span class=\"token punctuation\">:</span><span class=\"token keyword\">class</span><span class=\"token punctuation\">,</span></code></pre></div>\n<p>Add the following facades to aliases array.</p>\n<div class=\"gatsby-highlight\" data-language=\"php\"><pre class=\"language-php\"><code class=\"language-php\"><span class=\"token single-quoted-string string\">'JWTAuth'</span> <span class=\"token operator\">=</span><span class=\"token operator\">></span> Tymon\\<span class=\"token package\">JWTAuth<span class=\"token punctuation\">\\</span>Facades<span class=\"token punctuation\">\\</span>JWTAuth</span><span class=\"token punctuation\">:</span><span class=\"token punctuation\">:</span><span class=\"token keyword\">class</span><span class=\"token punctuation\">,</span> \n<span class=\"token single-quoted-string string\">'JWTFactory'</span> <span class=\"token operator\">=</span><span class=\"token operator\">></span> Tymon\\<span class=\"token package\">JWTAuth<span class=\"token punctuation\">\\</span>Facades<span class=\"token punctuation\">\\</span>JWTFactory</span><span class=\"token punctuation\">:</span><span class=\"token punctuation\">:</span><span class=\"token keyword\">class</span><span class=\"token punctuation\">,</span></code></pre></div>\n<p>Run this command to publish JWT config file</p>\n<div class=\"gatsby-highlight\" data-language=\"no-highlight\"><pre class=\"language-no-highlight\"><code class=\"language-no-highlight\">$ php artisan vendor:publish --provider=&quot;Tymon\\JWTAuth\\Providers\\LaravelServiceProvider&quot;</code></pre></div>\n<p>Then run this to generate secret key</p>\n<div class=\"gatsby-highlight\" data-language=\"no-highlight\"><pre class=\"language-no-highlight\"><code class=\"language-no-highlight\">$ php artisan jwt:secret</code></pre></div>\n<p>After that we need to use Tymon\\JWTAuth\\Contracts\\JWTSubject interface in our User model and implement methods getJWTIdentifier and getJWTCustomClaims.</p>\n<div class=\"gatsby-highlight\" data-language=\"php\"><pre class=\"language-php\"><code class=\"language-php\"><span class=\"token php language-php\"><span class=\"token delimiter important\">&lt;?php</span>\n\n<span class=\"token keyword\">namespace</span> <span class=\"token package\">App</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token keyword\">use</span> <span class=\"token package\">Illuminate<span class=\"token punctuation\">\\</span>Notifications<span class=\"token punctuation\">\\</span>Notifiable</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">use</span> <span class=\"token package\">Illuminate<span class=\"token punctuation\">\\</span>Contracts<span class=\"token punctuation\">\\</span>Auth<span class=\"token punctuation\">\\</span>MustVerifyEmail</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">use</span> <span class=\"token package\">Illuminate<span class=\"token punctuation\">\\</span>Foundation<span class=\"token punctuation\">\\</span>Auth<span class=\"token punctuation\">\\</span>User</span> <span class=\"token keyword\">as</span> Authenticatable<span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">use</span> <span class=\"token package\">Tymon<span class=\"token punctuation\">\\</span>JWTAuth<span class=\"token punctuation\">\\</span>Contracts<span class=\"token punctuation\">\\</span>JWTSubject</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token keyword\">class</span> <span class=\"token class-name\">User</span> <span class=\"token keyword\">extends</span> <span class=\"token class-name\">Authenticatable</span> <span class=\"token keyword\">implements</span> <span class=\"token class-name\">JWTSubject</span>\n<span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">use</span> <span class=\"token package\">Notifiable</span><span class=\"token punctuation\">;</span>\n\n    <span class=\"token comment\">/**\n     * The attributes that are mass assignable.\n     *\n     * @var array\n     */</span>\n    <span class=\"token keyword\">protected</span> <span class=\"token variable\">$fillable</span> <span class=\"token operator\">=</span> <span class=\"token punctuation\">[</span>\n        <span class=\"token single-quoted-string string\">'name'</span><span class=\"token punctuation\">,</span> <span class=\"token single-quoted-string string\">'email'</span><span class=\"token punctuation\">,</span> <span class=\"token single-quoted-string string\">'password'</span><span class=\"token punctuation\">,</span>\n    <span class=\"token punctuation\">]</span><span class=\"token punctuation\">;</span>\n\n    <span class=\"token comment\">/**\n     * The attributes that should be hidden for arrays.\n     *\n     * @var array\n     */</span>\n    <span class=\"token keyword\">protected</span> <span class=\"token variable\">$hidden</span> <span class=\"token operator\">=</span> <span class=\"token punctuation\">[</span>\n        <span class=\"token single-quoted-string string\">'password'</span><span class=\"token punctuation\">,</span> <span class=\"token single-quoted-string string\">'remember_token'</span><span class=\"token punctuation\">,</span>\n    <span class=\"token punctuation\">]</span><span class=\"token punctuation\">;</span>\n\n    <span class=\"token keyword\">public</span> <span class=\"token keyword\">function</span> <span class=\"token function\">getJWTIdentifier</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n    <span class=\"token punctuation\">{</span>\n        <span class=\"token keyword\">return</span> <span class=\"token variable\">$this</span><span class=\"token operator\">-</span><span class=\"token operator\">></span><span class=\"token function\">getKey</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n\n    <span class=\"token keyword\">public</span> <span class=\"token keyword\">function</span> <span class=\"token function\">getJWTCustomClaims</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n    <span class=\"token punctuation\">{</span>\n        <span class=\"token keyword\">return</span> <span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n\n\n<span class=\"token punctuation\">}</span></span></code></pre></div>\n<p>For authentication logic create UserController</p>\n<div class=\"gatsby-highlight\" data-language=\"no-highlight\"><pre class=\"language-no-highlight\"><code class=\"language-no-highlight\">$ php artisan make:controller UserController</code></pre></div>\n<p>In UserController add this code</p>\n<div class=\"gatsby-highlight\" data-language=\"php\"><pre class=\"language-php\"><code class=\"language-php\"><span class=\"token php language-php\"><span class=\"token delimiter important\">&lt;?php</span>\n\n<span class=\"token keyword\">namespace</span> <span class=\"token package\">App<span class=\"token punctuation\">\\</span>Http<span class=\"token punctuation\">\\</span>Controllers</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token keyword\">use</span> <span class=\"token package\">App<span class=\"token punctuation\">\\</span>User</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">use</span> <span class=\"token package\">Illuminate<span class=\"token punctuation\">\\</span>Http<span class=\"token punctuation\">\\</span>Request</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">use</span> <span class=\"token package\">Illuminate<span class=\"token punctuation\">\\</span>Support<span class=\"token punctuation\">\\</span>Facades<span class=\"token punctuation\">\\</span>Hash</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">use</span> <span class=\"token package\">Illuminate<span class=\"token punctuation\">\\</span>Support<span class=\"token punctuation\">\\</span>Facades<span class=\"token punctuation\">\\</span>Validator</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">use</span> <span class=\"token package\">JWTAuth</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">use</span> <span class=\"token package\">Tymon<span class=\"token punctuation\">\\</span>JWTAuth<span class=\"token punctuation\">\\</span>Exceptions<span class=\"token punctuation\">\\</span>JWTException</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">use</span> <span class=\"token package\">Tymon<span class=\"token punctuation\">\\</span>JWTAuth<span class=\"token punctuation\">\\</span>Exceptions<span class=\"token punctuation\">\\</span>TokenExpiredException</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">use</span> <span class=\"token package\">Tymon<span class=\"token punctuation\">\\</span>JWTAuth<span class=\"token punctuation\">\\</span>Exceptions<span class=\"token punctuation\">\\</span>TokenInvalidException</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token keyword\">class</span> <span class=\"token class-name\">UserController</span> <span class=\"token keyword\">extends</span> <span class=\"token class-name\">Controller</span>\n<span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">public</span> <span class=\"token keyword\">function</span> <span class=\"token function\">authenticate</span><span class=\"token punctuation\">(</span>Request <span class=\"token variable\">$request</span><span class=\"token punctuation\">)</span>\n    <span class=\"token punctuation\">{</span>\n        <span class=\"token variable\">$credentials</span> <span class=\"token operator\">=</span> <span class=\"token variable\">$request</span><span class=\"token operator\">-</span><span class=\"token operator\">></span><span class=\"token function\">only</span><span class=\"token punctuation\">(</span><span class=\"token single-quoted-string string\">'email'</span><span class=\"token punctuation\">,</span> <span class=\"token single-quoted-string string\">'password'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n        <span class=\"token keyword\">try</span> <span class=\"token punctuation\">{</span>\n            <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span><span class=\"token operator\">!</span><span class=\"token variable\">$token</span> <span class=\"token operator\">=</span> JWTAuth<span class=\"token punctuation\">:</span><span class=\"token punctuation\">:</span><span class=\"token function\">attempt</span><span class=\"token punctuation\">(</span><span class=\"token variable\">$credentials</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n                <span class=\"token keyword\">return</span> <span class=\"token function\">response</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token operator\">-</span><span class=\"token operator\">></span><span class=\"token function\">json</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">[</span><span class=\"token single-quoted-string string\">'error'</span> <span class=\"token operator\">=</span><span class=\"token operator\">></span> <span class=\"token single-quoted-string string\">'invalid_credentials'</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span> <span class=\"token number\">400</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n            <span class=\"token punctuation\">}</span>\n        <span class=\"token punctuation\">}</span> <span class=\"token keyword\">catch</span> <span class=\"token punctuation\">(</span>JWTException <span class=\"token variable\">$e</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n            <span class=\"token keyword\">return</span> <span class=\"token function\">response</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token operator\">-</span><span class=\"token operator\">></span><span class=\"token function\">json</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">[</span><span class=\"token single-quoted-string string\">'error'</span> <span class=\"token operator\">=</span><span class=\"token operator\">></span> <span class=\"token single-quoted-string string\">'could_not_create_token'</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span> <span class=\"token number\">500</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        <span class=\"token punctuation\">}</span>\n\n        <span class=\"token keyword\">return</span> <span class=\"token function\">response</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token operator\">-</span><span class=\"token operator\">></span><span class=\"token function\">json</span><span class=\"token punctuation\">(</span><span class=\"token function\">compact</span><span class=\"token punctuation\">(</span><span class=\"token single-quoted-string string\">'token'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n\n\n    <span class=\"token keyword\">public</span> <span class=\"token keyword\">function</span> <span class=\"token function\">register</span><span class=\"token punctuation\">(</span>Request <span class=\"token variable\">$request</span><span class=\"token punctuation\">)</span>\n    <span class=\"token punctuation\">{</span>\n        <span class=\"token variable\">$validator</span> <span class=\"token operator\">=</span> Validator<span class=\"token punctuation\">:</span><span class=\"token punctuation\">:</span><span class=\"token function\">make</span><span class=\"token punctuation\">(</span><span class=\"token variable\">$request</span><span class=\"token operator\">-</span><span class=\"token operator\">></span><span class=\"token function\">all</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">[</span>\n            <span class=\"token single-quoted-string string\">'name'</span> <span class=\"token operator\">=</span><span class=\"token operator\">></span> <span class=\"token single-quoted-string string\">'required|string|max:255'</span><span class=\"token punctuation\">,</span>\n            <span class=\"token single-quoted-string string\">'email'</span> <span class=\"token operator\">=</span><span class=\"token operator\">></span> <span class=\"token single-quoted-string string\">'required|string|email|max:255|unique:users'</span><span class=\"token punctuation\">,</span>\n            <span class=\"token single-quoted-string string\">'password'</span> <span class=\"token operator\">=</span><span class=\"token operator\">></span> <span class=\"token single-quoted-string string\">'required|string|min:2|confirmed'</span><span class=\"token punctuation\">,</span>\n        <span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n        <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span><span class=\"token variable\">$validator</span><span class=\"token operator\">-</span><span class=\"token operator\">></span><span class=\"token function\">fails</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n            <span class=\"token keyword\">return</span> <span class=\"token function\">response</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token operator\">-</span><span class=\"token operator\">></span><span class=\"token function\">json</span><span class=\"token punctuation\">(</span><span class=\"token variable\">$validator</span><span class=\"token operator\">-</span><span class=\"token operator\">></span><span class=\"token function\">errors</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span> <span class=\"token number\">400</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        <span class=\"token punctuation\">}</span>\n\n        <span class=\"token variable\">$user</span> <span class=\"token operator\">=</span> User<span class=\"token punctuation\">:</span><span class=\"token punctuation\">:</span><span class=\"token function\">create</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">[</span>\n            <span class=\"token single-quoted-string string\">'name'</span> <span class=\"token operator\">=</span><span class=\"token operator\">></span> <span class=\"token variable\">$request</span><span class=\"token operator\">-</span><span class=\"token operator\">></span><span class=\"token function\">get</span><span class=\"token punctuation\">(</span><span class=\"token single-quoted-string string\">'name'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n            <span class=\"token single-quoted-string string\">'email'</span> <span class=\"token operator\">=</span><span class=\"token operator\">></span> <span class=\"token variable\">$request</span><span class=\"token operator\">-</span><span class=\"token operator\">></span><span class=\"token function\">get</span><span class=\"token punctuation\">(</span><span class=\"token single-quoted-string string\">'email'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n            <span class=\"token single-quoted-string string\">'password'</span> <span class=\"token operator\">=</span><span class=\"token operator\">></span> Hash<span class=\"token punctuation\">:</span><span class=\"token punctuation\">:</span><span class=\"token function\">make</span><span class=\"token punctuation\">(</span><span class=\"token variable\">$request</span><span class=\"token operator\">-</span><span class=\"token operator\">></span><span class=\"token function\">get</span><span class=\"token punctuation\">(</span><span class=\"token single-quoted-string string\">'password'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n        <span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n        <span class=\"token variable\">$token</span> <span class=\"token operator\">=</span> JWTAuth<span class=\"token punctuation\">:</span><span class=\"token punctuation\">:</span><span class=\"token function\">fromUser</span><span class=\"token punctuation\">(</span><span class=\"token variable\">$user</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n        <span class=\"token keyword\">return</span> <span class=\"token function\">response</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token operator\">-</span><span class=\"token operator\">></span><span class=\"token function\">json</span><span class=\"token punctuation\">(</span><span class=\"token function\">compact</span><span class=\"token punctuation\">(</span><span class=\"token single-quoted-string string\">'user'</span><span class=\"token punctuation\">,</span> <span class=\"token single-quoted-string string\">'token'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span> <span class=\"token number\">201</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n\n    <span class=\"token keyword\">public</span> <span class=\"token keyword\">function</span> <span class=\"token function\">me</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n    <span class=\"token punctuation\">{</span>\n        <span class=\"token keyword\">return</span> <span class=\"token function\">response</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token operator\">-</span><span class=\"token operator\">></span><span class=\"token function\">json</span><span class=\"token punctuation\">(</span><span class=\"token function\">auth</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token operator\">-</span><span class=\"token operator\">></span><span class=\"token function\">user</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n\n\n    <span class=\"token keyword\">public</span> <span class=\"token keyword\">function</span> <span class=\"token function\">getAuthenticatedUser</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n    <span class=\"token punctuation\">{</span>\n        <span class=\"token keyword\">try</span> <span class=\"token punctuation\">{</span>\n\n            <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span><span class=\"token operator\">!</span><span class=\"token variable\">$user</span> <span class=\"token operator\">=</span> JWTAuth<span class=\"token punctuation\">:</span><span class=\"token punctuation\">:</span><span class=\"token function\">parseToken</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token operator\">-</span><span class=\"token operator\">></span><span class=\"token function\">authenticate</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n                <span class=\"token keyword\">return</span> <span class=\"token function\">response</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token operator\">-</span><span class=\"token operator\">></span><span class=\"token function\">json</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">[</span><span class=\"token single-quoted-string string\">'user_not_found'</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span> <span class=\"token number\">404</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n            <span class=\"token punctuation\">}</span>\n\n        <span class=\"token punctuation\">}</span> <span class=\"token keyword\">catch</span> <span class=\"token punctuation\">(</span> TokenExpiredException <span class=\"token variable\">$e</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n\n            <span class=\"token keyword\">return</span> <span class=\"token function\">response</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token operator\">-</span><span class=\"token operator\">></span><span class=\"token function\">json</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">[</span><span class=\"token single-quoted-string string\">'token_expired'</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span> <span class=\"token variable\">$e</span><span class=\"token operator\">-</span><span class=\"token operator\">></span><span class=\"token function\">getStatusCode</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n        <span class=\"token punctuation\">}</span> <span class=\"token keyword\">catch</span> <span class=\"token punctuation\">(</span> TokenInvalidException <span class=\"token variable\">$e</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n\n            <span class=\"token keyword\">return</span> <span class=\"token function\">response</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token operator\">-</span><span class=\"token operator\">></span><span class=\"token function\">json</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">[</span><span class=\"token single-quoted-string string\">'token_invalid'</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span> <span class=\"token variable\">$e</span><span class=\"token operator\">-</span><span class=\"token operator\">></span><span class=\"token function\">getStatusCode</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n        <span class=\"token punctuation\">}</span> <span class=\"token keyword\">catch</span> <span class=\"token punctuation\">(</span> JWTException <span class=\"token variable\">$e</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n\n            <span class=\"token keyword\">return</span> <span class=\"token function\">response</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token operator\">-</span><span class=\"token operator\">></span><span class=\"token function\">json</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">[</span><span class=\"token single-quoted-string string\">'token_absent'</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span> <span class=\"token variable\">$e</span><span class=\"token operator\">-</span><span class=\"token operator\">></span><span class=\"token function\">getStatusCode</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n        <span class=\"token punctuation\">}</span>\n\n        <span class=\"token keyword\">return</span> <span class=\"token function\">response</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token operator\">-</span><span class=\"token operator\">></span><span class=\"token function\">json</span><span class=\"token punctuation\">(</span><span class=\"token function\">compact</span><span class=\"token punctuation\">(</span><span class=\"token single-quoted-string string\">'user'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n\n\n    <span class=\"token keyword\">public</span> <span class=\"token keyword\">function</span> <span class=\"token function\">logout</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n    <span class=\"token punctuation\">{</span>\n        JWTAuth<span class=\"token punctuation\">:</span><span class=\"token punctuation\">:</span><span class=\"token function\">invalidate</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        <span class=\"token keyword\">return</span> <span class=\"token function\">response</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">[</span>\n            <span class=\"token single-quoted-string string\">'status'</span> <span class=\"token operator\">=</span><span class=\"token operator\">></span> <span class=\"token single-quoted-string string\">'success'</span><span class=\"token punctuation\">,</span>\n            <span class=\"token single-quoted-string string\">'msg'</span> <span class=\"token operator\">=</span><span class=\"token operator\">></span> <span class=\"token single-quoted-string string\">'Logged out Successfully.'</span>\n        <span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span> <span class=\"token number\">200</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n\n<span class=\"token punctuation\">}</span></span></code></pre></div>\n<h3>Crete middleware and routes</h3>\n<p>We need to create a middleware to use token in authentication.</p>\n<div class=\"gatsby-highlight\" data-language=\"no-highlight\"><pre class=\"language-no-highlight\"><code class=\"language-no-highlight\">$ php artisan make:middleware JwtMiddleware</code></pre></div>\n<p>In the app/Http/Middleware/JwtMiddleware file add this code</p>\n<div class=\"gatsby-highlight\" data-language=\"php\"><pre class=\"language-php\"><code class=\"language-php\"><span class=\"token php language-php\"><span class=\"token delimiter important\">&lt;?php</span>\n\n<span class=\"token keyword\">namespace</span> <span class=\"token package\">App<span class=\"token punctuation\">\\</span>Http<span class=\"token punctuation\">\\</span>Middleware</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token keyword\">use</span> <span class=\"token package\">Closure</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">use</span> <span class=\"token package\">JWTAuth</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">use</span> <span class=\"token package\">Exception</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">use</span> <span class=\"token package\">Tymon<span class=\"token punctuation\">\\</span>JWTAuth<span class=\"token punctuation\">\\</span>Http<span class=\"token punctuation\">\\</span>Middleware<span class=\"token punctuation\">\\</span>BaseMiddleware</span><span class=\"token punctuation\">;</span>\n\n\n<span class=\"token keyword\">class</span> <span class=\"token class-name\">JwtMiddleware</span> <span class=\"token keyword\">extends</span> <span class=\"token class-name\">BaseMiddleware</span>\n<span class=\"token punctuation\">{</span>\n    <span class=\"token comment\">/**\n     * Handle an incoming request.\n     *\n     * @param  \\Illuminate\\Http\\Request  $request\n     * @param  \\Closure  $next\n     * @return mixed\n     */</span>\n    <span class=\"token keyword\">public</span> <span class=\"token keyword\">function</span> <span class=\"token function\">handle</span><span class=\"token punctuation\">(</span><span class=\"token variable\">$request</span><span class=\"token punctuation\">,</span> Closure <span class=\"token variable\">$next</span><span class=\"token punctuation\">)</span>\n    <span class=\"token punctuation\">{</span>\n        <span class=\"token keyword\">try</span> <span class=\"token punctuation\">{</span>\n            <span class=\"token variable\">$user</span> <span class=\"token operator\">=</span> JWTAuth<span class=\"token punctuation\">:</span><span class=\"token punctuation\">:</span><span class=\"token function\">parseToken</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token operator\">-</span><span class=\"token operator\">></span><span class=\"token function\">authenticate</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        <span class=\"token punctuation\">}</span> <span class=\"token keyword\">catch</span> <span class=\"token punctuation\">(</span>Exception <span class=\"token variable\">$e</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n            <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span><span class=\"token variable\">$e</span> <span class=\"token keyword\">instanceof</span> <span class=\"token class-name\"><span class=\"token punctuation\">\\</span>Tymon<span class=\"token punctuation\">\\</span>JWTAuth<span class=\"token punctuation\">\\</span>Exceptions<span class=\"token punctuation\">\\</span>TokenInvalidException</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">{</span>\n                <span class=\"token keyword\">return</span> <span class=\"token function\">response</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token operator\">-</span><span class=\"token operator\">></span><span class=\"token function\">json</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">[</span><span class=\"token single-quoted-string string\">'status'</span> <span class=\"token operator\">=</span><span class=\"token operator\">></span> <span class=\"token single-quoted-string string\">'Token is Invalid'</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n            <span class=\"token punctuation\">}</span><span class=\"token keyword\">else</span> <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span><span class=\"token variable\">$e</span> <span class=\"token keyword\">instanceof</span> <span class=\"token class-name\"><span class=\"token punctuation\">\\</span>Tymon<span class=\"token punctuation\">\\</span>JWTAuth<span class=\"token punctuation\">\\</span>Exceptions<span class=\"token punctuation\">\\</span>TokenExpiredException</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">{</span>\n                <span class=\"token keyword\">return</span> <span class=\"token function\">response</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token operator\">-</span><span class=\"token operator\">></span><span class=\"token function\">json</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">[</span><span class=\"token single-quoted-string string\">'status'</span> <span class=\"token operator\">=</span><span class=\"token operator\">></span> <span class=\"token single-quoted-string string\">'Token is Expired'</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n            <span class=\"token punctuation\">}</span><span class=\"token keyword\">else</span><span class=\"token punctuation\">{</span>\n                <span class=\"token keyword\">return</span> <span class=\"token function\">response</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token operator\">-</span><span class=\"token operator\">></span><span class=\"token function\">json</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">[</span><span class=\"token single-quoted-string string\">'status'</span> <span class=\"token operator\">=</span><span class=\"token operator\">></span> <span class=\"token single-quoted-string string\">'Authorization Token not found'</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n            <span class=\"token punctuation\">}</span>\n        <span class=\"token punctuation\">}</span>\n\n        <span class=\"token keyword\">return</span> <span class=\"token variable\">$next</span><span class=\"token punctuation\">(</span><span class=\"token variable\">$request</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span></span></code></pre></div>\n<p>In app/http/Kernel.php we need to add middleware to <code class=\"language-text\">$routeMiddleware</code> array.</p>\n<div class=\"gatsby-highlight\" data-language=\"php\"><pre class=\"language-php\"><code class=\"language-php\"><span class=\"token keyword\">protected</span> <span class=\"token variable\">$routeMiddleware</span> <span class=\"token operator\">=</span> <span class=\"token punctuation\">[</span>\n        <span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span><span class=\"token punctuation\">,</span>\n        <span class=\"token single-quoted-string string\">'jwt.verify'</span> <span class=\"token operator\">=</span><span class=\"token operator\">></span> \\<span class=\"token package\">App<span class=\"token punctuation\">\\</span>Http<span class=\"token punctuation\">\\</span>Middleware<span class=\"token punctuation\">\\</span>JwtMiddleware</span><span class=\"token punctuation\">:</span><span class=\"token punctuation\">:</span><span class=\"token keyword\">class</span><span class=\"token punctuation\">,</span>\n    <span class=\"token punctuation\">]</span><span class=\"token punctuation\">;</span></code></pre></div>\n<p>Now in routes/api.php file add this routes.</p>\n<div class=\"gatsby-highlight\" data-language=\"php\"><pre class=\"language-php\"><code class=\"language-php\">Route<span class=\"token punctuation\">:</span><span class=\"token punctuation\">:</span><span class=\"token function\">post</span><span class=\"token punctuation\">(</span><span class=\"token single-quoted-string string\">'register'</span><span class=\"token punctuation\">,</span> <span class=\"token single-quoted-string string\">'UserController@register'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\nRoute<span class=\"token punctuation\">:</span><span class=\"token punctuation\">:</span><span class=\"token function\">post</span><span class=\"token punctuation\">(</span><span class=\"token single-quoted-string string\">'login'</span><span class=\"token punctuation\">,</span> <span class=\"token single-quoted-string string\">'UserController@authenticate'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\nRoute<span class=\"token punctuation\">:</span><span class=\"token punctuation\">:</span><span class=\"token function\">group</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">[</span><span class=\"token single-quoted-string string\">'middleware'</span> <span class=\"token operator\">=</span><span class=\"token operator\">></span> <span class=\"token punctuation\">[</span><span class=\"token single-quoted-string string\">'jwt.verify'</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span> <span class=\"token keyword\">function</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    Route<span class=\"token punctuation\">:</span><span class=\"token punctuation\">:</span><span class=\"token function\">get</span><span class=\"token punctuation\">(</span><span class=\"token single-quoted-string string\">'user'</span><span class=\"token punctuation\">,</span> <span class=\"token single-quoted-string string\">'UserController@getAuthenticatedUser'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code></pre></div>\n<p>Now our api authentication is ready. We can test it in our postman app.</p>\n<p>If we create post request to login route with our credentials.\n<span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto;  max-width: 690px;\"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/bb1bc3ede213991da1366585e91295d1/95139/postman1.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 56.22254758418741%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAALCAYAAAB/Ca1DAAAACXBIWXMAAAsSAAALEgHS3X78AAAB6UlEQVQoz2VRW3LTMBT1rihMmzTMQJg2sdumST744Z8twDK6GFbAJuCDGT5IalvWW5ZlH65UpzWDZs7cK92ro3OusqvlAvnyEst3c8wuzjCfYnaWzpbvFwkX56/+q1/OXmMxf4O3i3MUHxbIHj5/xNdPW9ztdtjvtthsbrFerxJW11e4yVfY3m9wd1tgv9+hKPJUy/M1rqke93meo7ih+vYemeUMqi7BqhINl2CsRk25kBJaCkhWgtc1xQrWGFhrYcbIOcfxeITiVG9qlGWJzDsLrwQ6Z9B1XSKqa0bEDFVVoSKyZ9A+kkjqEULCaoU/zODLN43vP4jDCGSgFWSD9vfPmMJKDkFqjLHQWk+gkrII51xCVGysw6+qBeM63c2iKskbCLLZeo+GlCmyOl193yfSGKdnzrXTLnJpyTKRaKXShZZe5UIkFf0wpEvDGGNfoNiP6EKAJzGBYsz70KGjnuyJPJBvn1JH1iSRaqNhKNdk3Vmab+swxAeoN8J3Hs47tBRjHiyNhJxlUcFARCf4tiXF8WMaHCqBR6bwWAuakQKTLqFRDtK0UMZDWU+5B9e012ZUOK5EnhCowaUfLLlNODQGB6YTSm4giPCESB4JLc00C+McTrMJ4WlPvtKg/8Xwkg8viAIiOrL+F1DRBaug7pRdAAAAAElFTkSuQmCC'); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"Image of token response\"\n        title=\"Image of token response\"\n        src=\"/static/bb1bc3ede213991da1366585e91295d1/36727/postman1.png\"\n        srcset=\"/static/bb1bc3ede213991da1366585e91295d1/acf4b/postman1.png 173w,\n/static/bb1bc3ede213991da1366585e91295d1/fc834/postman1.png 345w,\n/static/bb1bc3ede213991da1366585e91295d1/36727/postman1.png 690w,\n/static/bb1bc3ede213991da1366585e91295d1/17fa4/postman1.png 1035w,\n/static/bb1bc3ede213991da1366585e91295d1/95139/postman1.png 1366w\"\n        sizes=\"(max-width: 690px) 100vw, 690px\"\n        loading=\"lazy\"\n      />\n  </a>\n    </span></p>\n<p>If we want to consume api from another application we have to configure CORS and we can do it easily by <a href=\"https://github.com/barryvdh/laravel-cors\">barryvdh/laravel-cors</a>.</p>","timeToRead":4,"excerpt":"For creating REST API we use jwt token for stateless authentication. In this post I will show you how to add jwt to laravel for api…","frontmatter":{"title":"JWT authentication with laravel","cover":"https://unsplash.it/400/300/?random?BigTest","date":"2019-11-09","category":"moar","tags":["laravel","restapi"],"posttype":null,"featuredImage":{"childImageSharp":{"sizes":{"base64":"data:image/jpeg;base64,/9j/2wBDABALDA4MChAODQ4SERATGCgaGBYWGDEjJR0oOjM9PDkzODdASFxOQERXRTc4UG1RV19iZ2hnPk1xeXBkeFxlZ2P/2wBDARESEhgVGC8aGi9jQjhCY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2P/wgARCAALABQDASIAAhEBAxEB/8QAFwABAQEBAAAAAAAAAAAAAAAAAAMBBf/EABUBAQEAAAAAAAAAAAAAAAAAAAAC/9oADAMBAAIQAxAAAAHppTqatH//xAAWEAEBAQAAAAAAAAAAAAAAAAABEAD/2gAIAQEAAQUCjm//xAAUEQEAAAAAAAAAAAAAAAAAAAAQ/9oACAEDAQE/AT//xAAUEQEAAAAAAAAAAAAAAAAAAAAQ/9oACAECAQE/AT//xAAUEAEAAAAAAAAAAAAAAAAAAAAg/9oACAEBAAY/Al//xAAaEAACAgMAAAAAAAAAAAAAAAAAAREhEDGR/9oACAEBAAE/IZolyNZqzuP/2gAMAwEAAgADAAAAELfP/8QAFhEBAQEAAAAAAAAAAAAAAAAAAAER/9oACAEDAQE/EKx//8QAFREBAQAAAAAAAAAAAAAAAAAAABH/2gAIAQIBAT8Qqv/EABsQAQADAQEBAQAAAAAAAAAAAAEAESExQXGR/9oACAEBAAE/EDydl2kCuZB9S1FutdhjY2+soeh+T//Z","aspectRatio":1.7777777777777777,"src":"/static/8c39a9628ad1a740b866bc0f32ed9706/30037/banner.jpg","srcSet":"/static/8c39a9628ad1a740b866bc0f32ed9706/10bdc/banner.jpg 158w,\n/static/8c39a9628ad1a740b866bc0f32ed9706/f4ab0/banner.jpg 315w,\n/static/8c39a9628ad1a740b866bc0f32ed9706/30037/banner.jpg 630w,\n/static/8c39a9628ad1a740b866bc0f32ed9706/9810d/banner.jpg 945w,\n/static/8c39a9628ad1a740b866bc0f32ed9706/ff2e4/banner.jpg 1260w,\n/static/8c39a9628ad1a740b866bc0f32ed9706/c108b/banner.jpg 1280w","sizes":"(max-width: 630px) 100vw, 630px"}}}},"fields":{"slug":"/laravel-jwt-authentication","date":"2019-11-09T00:00:00.000Z"}}},"pageContext":{"isCreatedByStatefulCreatePages":false,"slug":"/laravel-jwt-authentication","nexttitle":"Big Test","nextslug":"/big-sample-test","prevtitle":"Project one","prevslug":"/project-one"}}}